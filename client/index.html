<canvas id= "ctx" width="500" height="500" style="border:1px solid #000000;"></canvas>
<div id= "chat-text" style="width:500px;height:100px;overflow-y:scroll">
	</div>
	<form id="chat-form">
		<input id="chat-input" type="text" style:"width:500px">
	</form>
<script src="/socket.io/socket.io.js"></script>
<script>
	let ctx = document.getElementById("ctx").getContext("2d");
	let chatText = document.getElementById("chat-text");
	let chatForm = document.getElementById("chat-form");
	let chatInput = document.getElementById("chat-input");
	let socket = io();
  ctx.font = '30px Arial';
  socket.on('newPosition', function (data) {
    ctx.clearRect(0,0,500,500);
    for(let i = 0; i< data.player.length; i++){
    	ctx.fillText(data.player[i].number, data.player[i].x, data.player[i].y);
    }
    for(let i = 0; i< data.bullet.length; i++){
    	ctx.fillRect(data.bullet[i].x-5, data.bullet[i].y-5, 10, 10);
  }});

  socket.on('addToChat', function(data){
  	console.log("Message Happened");
  	chatText.innerHTML += '<div>' + data + '</div>';
  })
  chatForm.onsubmit = function(e){
  	e.preventDefault();
  	socket.emit('sendMsgToServer', chatInput.value);
  	chatInput.value = '';
  }
   document.onkeydown = function(event){
        if(event.keyCode === 68)    //d
            socket.emit('keyPress',{inputId:'right',state:true});
        else if(event.keyCode === 83)   //s
            socket.emit('keyPress',{inputId:'down',state:true});
        else if(event.keyCode === 65) //a
            socket.emit('keyPress',{inputId:'left',state:true});
        else if(event.keyCode === 87) // w
            socket.emit('keyPress',{inputId:'up',state:true});
    }
    document.onkeyup = function(event){
        if(event.keyCode === 68)    //d
            socket.emit('keyPress',{inputId:'right',state:false});
        else if(event.keyCode === 83)   //s
            socket.emit('keyPress',{inputId:'down',state:false});
        else if(event.keyCode === 65) //a
            socket.emit('keyPress',{inputId:'left',state:false});
        else if(event.keyCode === 87) // w
            socket.emit('keyPress',{inputId:'up',state:false});
    }

    document.onmousedown = function (event){
    	socket.emit('keyPress', {inputId:'attack', state:true});
    }
    document.onmouseup= function (event){
    	socket.emit('keyPress', {inputId:'attack', state:false});
    }
    document.onmousemove = function(event){
    	let x = -250 + event.clientX -8;
    	let y = -250 + event.clientY -8;
    	let angle = Math.atan2(y, x) /Math.PI *180;
    	socket.emit('keyPress', {inputId:'mouseAngle', state:angle});
    }
    socket.on('evalAnswer', function(data){
    	console.log(data);
    })

</script>
